!function($){function hashScroll(wrapper,options){this.defaults=$.extend({selector:".page",speed:300,easing:"easeInOutQuad",offset:0,stopOnOffset:!0,beforeMove:function(){},afterMove:function(){},onPageActive:function(){},onReachOffset:function(){}},options),this.wrapper=wrapper,this.$targets=null,this.$active=null,this.watchHash=!0,this.run()}hashScroll.prototype={run:function(options){this.getTargets(),this.bindUI(),this.activeByHash()},getTargets:function(){if(null==this.$targets){var targets=[];$(this.wrapper).find(this.defaults.selector).each(function(){targets.push($("#"+$(this).attr("id")))}),this.$targets=targets}return this.$targets},getTarget:function(){var targets=this.getTargets(),scrollTop=$(window).scrollTop()+this.defaults.offset;return targets=$(targets).map(function(){return $(this).offset().top<=scrollTop?this:void 0}),targets.length>0?targets[targets.length-1]:null},getActive:function(){return null==this.$active?this.getTargets()[0]:this.$active},getPrev:function(){var $prev=this.getActive().prevAll(this.defaults.selector).first();return $prev.length?$prev:this.getActive()},getNext:function(){var $next=this.getActive().nextAll(this.defaults.selector).first();return $next.length?$next:this.getActive()},getHash:function(){var hash=window.location.hash;return hash&&(hash=hash.replace("!","").split("/")[0]),hash},belongsToTargets:function(hash){return"undefined"!=typeof $(hash)&&$(hash).hasClass(this.defaults.selector.replace(".",""))},isCurrentTargetEqualsActive:function(){return this.getActive().is(this.getTarget())},active:function($target){this.$active=$target,this.move()},activeByHash:function(){var hash=this.getHash();hash&&this.belongsToTargets(hash)&&this.active($(hash))},updateHash:function(){this.isCurrentTargetEqualsActive()||null!=this.getTarget()&&(this.active(this.getTarget()),this.defaults.onPageActive(this.$active),this.watchHash&&(window.location.hash="!"+this.$active.attr("id")))},move:function(){if(!this.isCurrentTargetEqualsActive()){var self=this;self.watchHash=!1,self.defaults.beforeMove(self.getActive());var distance=self.defaults.stopOnOffset?self.getActive().offset().top-self.defaults.offset:self.getActive().offset().top;$("html,body").stop().animate({scrollTop:distance},self.defaults.speed,self.defaults.easing,function(){setTimeout(function(){self.watchHash=!0,self.defaults.afterMove(self.getActive())},300)})}},movePrev:function(){this.active(this.getPrev())},moveNext:function(){this.active(this.getNext())},bindUI:function(){var self=this;$(window).hashchange(function(){self.activeByHash()}).scroll(function(){self.updateHash()}),$(document).keydown(function(e){var charCode=e.which?e.which:event.keyCode;(40==charCode||38==charCode)&&(e.preventDefault(),40==charCode?self.moveNext():38==charCode&&self.movePrev())})}},$.fn.hashScroll=function(options){return this.each(function(){$(this).data("hashScroll",new hashScroll(this,options))})}}(jQuery);