!function($){function hashScroll(wrapper,options){this.defaults=$.extend({selector:".page",speed:1e3,easing:"easeInOutQuad",offset:0,stopOnOffset:!0,beforeMove:function(){},afterMove:function(){},onPageActive:function(){}},options),this.wrapper=wrapper,this.$targets=null,this.$target=null,this.$active=null,this.watchHash=!0,this.run()}hashScroll.prototype={run:function(options){this.getTargets(),this.bindUI()},getTargets:function(){if(null==this.$targets){var targets=[];$(this.wrapper).find(this.defaults.selector).each(function(){targets.push($("#"+$(this).attr("id")))}),this.$targets=targets}return this.$targets},getTarget:function(){var targets=this.getTargets(),scrollTop=$(window).scrollTop()+this.defaults.offset;return targets=$(targets).map(function(){return $(this).offset().top<=scrollTop?this:void 0}),targets.length>0?targets[targets.length-1]:null},getPrev:function(){return null==this.$active?this.getTargets()[0].prevAll(this.defaults.selector).first():this.$active.prevAll(this.defaults.selector).first()},getNext:function(){return null==this.$active?this.getTargets()[0].nextAll(this.defaults.selector).first():this.$active.nextAll(this.defaults.selector).first()},getHash:function(){var hash=window.location.hash;return hash&&(hash=hash.replace("!","").split("/")[0]),hash},isTarget:function(hash){return $(hash).length?$(hash).hasClass(this.defaults.selector.replace(".","")):!1},isTargetActive:function(){return null==this.$active?!1:this.$active.is(this.$target)},activeByHash:function(){var hash=this.getHash();hash&&this.isTarget(hash)&&(this.$target=$(hash),this.move(this.$target))},move:function($target){if(!this.isTargetActive()){var self=this;self.watchHash=!1,self.defaults.beforeMove($target);var distance=self.defaults.stopOnOffset?$target.offset().top-self.defaults.offset:$target.offset().top;$("html,body").stop().animate({scrollTop:distance},self.defaults.speed,self.defaults.easing,function(){setTimeout(function(){self.watchHash=!0,self.defaults.afterMove($target)},300)})}},movePrev:function(){this.$target=this.getPrev(),this.move(this.$target)},moveNext:function(){this.$target=this.getNext(),this.move(this.$target)},updateHash:function(){null!=this.getTarget()&&(this.$target=this.getTarget(),this.isTargetActive()||(this.$active=this.getTarget(),this.defaults.onPageActive(this.$active),this.watchHash&&(window.location.hash="!"+this.$active.attr("id"))))},bindUI:function(){var self=this;$(window).hashchange(function(){self.activeByHash()}).scroll(function(){self.updateHash()}).load(function(){self.activeByHash()}),$(document).keydown(function(e){var charCode=e.which?e.which:event.keyCode;(40==charCode||38==charCode)&&(e.preventDefault(),40==charCode?self.moveNext():38==charCode&&self.movePrev())})}},$.fn.hashScroll=function(options){return this.each(function(){$(this).data("hashScroll",new hashScroll(this,options))})}}(jQuery);