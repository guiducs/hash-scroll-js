!function($){function hashScroll(wrapper,options){this.defaults=$.extend({selector:".page",offset:0,speed:1e3,easing:"easeOutCubic",beforeMove:function(){},afterMove:function(){},onPageActive:function(){}},options),this.wrapper=wrapper,this.$targets=null,this.$active=null,this.hash="",this.watchHash=!0,this.run()}hashScroll.prototype={run:function(){this.getTargets(),this.bindUI(),this.activeByHash(),this.move()},getTargets:function(){if(null==this.$targets){var targets=[];$(this.wrapper).find(this.defaults.selector).each(function(){targets.push($("#"+$(this).attr("id")))}),this.$targets=targets}return this.$targets},getTarget:function(){var targets=this.getTargets(),scrollTop=$(window).scrollTop()+this.defaults.offset;return targets=$(targets).map(function(){return $(this).offset().top<=scrollTop?this:void 0}),targets.length>0?targets[targets.length-1]:null},getActive:function(){return null==this.$active&&(this.$active=this.getTargets()[0]),this.$active},getPrev:function(){var $prev=this.getActive().prevAll(this.defaults.selector).first();return $prev.length?$prev:this.$active},getNext:function(){var $next=this.getActive().nextAll(this.defaults.selector).first();return $next.length?$next:this.$active},getHash:function(){var hash=window.location.hash;return hash&&(hash=hash.replace("!","").split("/")[0]),hash},belongsToTargets:function(hash){return"undefined"!=typeof $(hash)&&$(hash).hasClass(this.defaults.selector.replace(".",""))},isCurrentTargetEqualsActive:function(){return this.getActive().is(this.getTarget())},activeByHash:function(){var hash=this.getHash();hash&&this.belongsToTargets(hash)&&(this.$active=$(hash))},updateHash:function(){this.isCurrentTargetEqualsActive()||(this.$active=this.getTarget(),this.watchHash&&(window.location.hash="!"+this.$active.attr("id")),this.defaults.onPageActive(this.$active))},move:function(){if(!this.isCurrentTargetEqualsActive()){var self=this;self.watchHash=!1,self.defaults.beforeMove(),$("html,body").stop().animate({scrollTop:self.getActive().offset().top-self.defaults.offset},self.defaults.speed,self.defaults.easing,function(){setTimeout(function(){-1===self.getHash().indexOf("#"+self.getActive().attr("id"))&&(window.location.hash="!"+self.getActive().attr("id")),self.defaults.onPageActive(self.$active),self.watchHash=!0},100)}),self.defaults.afterMove()}},movePrev:function(){this.$active=this.getPrev(),this.move()},moveNext:function(){this.$active=this.getNext(),this.move()},bindUI:function(){var self=this;$(window).hashchange(function(){self.hash=window.location.hash,self.activeByHash(),self.move()}).scroll(function(){self.updateHash()}).load(function(){self.defaults.onPageActive(self.getActive())}),$(document).keydown(function(e){var charCode=e.which?e.which:event.keyCode;(40==charCode||38==charCode)&&(e.preventDefault(),40==charCode?self.moveNext():38==charCode&&self.movePrev())})}},$.fn.hashScroll=function(options){return this.each(function(){$(this).data("hashScroll",new hashScroll(this,options))})}}(jQuery);